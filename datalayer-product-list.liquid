<script>
  window.dataLayer = window.dataLayer || [];

  {% if collection and collection.products.size > 0 %}
  window.dataLayer.push({
    'event': 'view_item_list',
    'ecommerce': {
      'item_list_id': '{{ collection.title | escape }}',
      'item_list_name': '{{ collection.title | escape }}',
      'items': [
        {% for product in collection.products %}
        {
          'item_id': '{{ product.id }}',
          'item_name': '{{ product.title | escape }}',
          'item_category': '{{ product.type | escape }}',
          'price': '{{ product.price | money_without_currency | replace: ',', '' }}',
          'quantity': 1
        }{% if forloop.last == false %},{% endif %}
        {% endfor %}
      ]
    }
  });
  {% endif %}
</script>
